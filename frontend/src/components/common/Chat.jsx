import React, { useState } from 'react';\nimport { Container, Row, Col, Card, Button, Form, InputGroup, Badge, ListGroup } from 'react-bootstrap';\nimport { useAuth } from '../../context/AuthContext';\nimport { toast } from 'react-toastify';\n\nconst Chat = () => {\n  const { user } = useAuth();\n  const [activeChat, setActiveChat] = useState(null);\n  const [message, setMessage] = useState('');\n  const [isTyping, setIsTyping] = useState(false);\n  \n  const [chats] = useState([\n    {\n      id: 1,\n      name: user?.role === 'shopkeeper' ? 'Apple Store' : 'John Doe',\n      role: user?.role === 'shopkeeper' ? 'vendor' : 'shopkeeper',\n      lastMessage: 'Thanks for your inquiry!',\n      time: '2 min ago',\n      unread: 3,\n      online: true\n    },\n    {\n      id: 2,\n      name: user?.role === 'shopkeeper' ? 'Samsung Store' : 'Jane Smith',\n      role: user?.role === 'shopkeeper' ? 'vendor' : 'shopkeeper',\n      lastMessage: 'Product is available',\n      time: '5 min ago',\n      unread: 1,\n      online: false\n    },\n    {\n      id: 3,\n      name: 'Customer Support',\n      role: 'support',\n      lastMessage: 'How can we help you?',\n      time: '1 hour ago',\n      unread: 0,\n      online: true\n    }\n  ]);\n  \n  const [messages, setMessages] = useState([\n    {\n      id: 1,\n      sender: 'other',\n      content: 'Hello! I saw your inquiry about the iPhone 15. We have it in stock.',\n      time: '10:30 AM',\n      type: 'text'\n    },\n    {\n      id: 2,\n      sender: 'me',\n      content: 'Great! What\\'s the best price you can offer?',\n      time: '10:32 AM',\n      type: 'text'\n    },\n    {\n      id: 3,\n      sender: 'other',\n      content: 'For bulk orders, I can offer â‚¹75,999 per unit. Minimum 10 units.',\n      time: '10:35 AM',\n      type: 'text'\n    }\n  ]);\n\n  const sendMessage = () => {\n    if (message.trim()) {\n      const newMessage = {\n        id: Date.now(),\n        sender: 'me',\n        content: message,\n        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\n        type: 'text'\n      };\n      \n      setMessages(prev => [...prev, newMessage]);\n      setMessage('');\n      \n      // Simulate typing and response\n      setIsTyping(true);\n      setTimeout(() => {\n        setIsTyping(false);\n        const responses = [\n          'That sounds good! Let me check with my team.',\n          'I can arrange that for you. When do you need delivery?',\n          'Perfect! I\\'ll prepare the quotation.',\n          'Great! Let me know if you need any other products.'\n        ];\n        const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n        \n        setMessages(prev => [...prev, {\n          id: Date.now() + 1,\n          sender: 'other',\n          content: randomResponse,\n          time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\n          type: 'text'\n        }]);\n      }, 2000);\n    }\n  };\n\n  const sendQuickReply = (reply) => {\n    setMessage(reply);\n    setTimeout(() => sendMessage(), 100);\n  };\n\n  const quickReplies = user?.role === 'shopkeeper' \n    ? ['What\\'s your best price?', 'Do you have bulk discounts?', 'When can you deliver?', 'Can you send samples?']\n    : ['Yes, available in stock', 'I can offer 10% discount', 'Delivery in 2-3 days', 'Let me check and get back'];\n\n  return (\n    <div style={{ minHeight: '100vh', backgroundColor: '#f8f9fa' }}>\n      <Container fluid className=\"py-4\">\n        <Row style={{ height: '80vh' }}>\n          {/* Chat List */}\n          <Col md={4} className=\"pe-2\">\n            <Card className=\"h-100 shadow-sm\">\n              <Card.Header className=\"bg-success text-white\">\n                <h5 className=\"mb-0\">ğŸ’¬ Chats</h5>\n              </Card.Header>\n              <Card.Body className=\"p-0\">\n                <ListGroup variant=\"flush\">\n                  {chats.map(chat => (\n                    <ListGroup.Item \n                      key={chat.id}\n                      action\n                      active={activeChat?.id === chat.id}\n                      onClick={() => setActiveChat(chat)}\n                      className=\"d-flex align-items-center p-3\"\n                    >\n                      <div className=\"me-3 position-relative\">\n                        <div \n                          className=\"rounded-circle bg-primary text-white d-flex align-items-center justify-content-center\"\n                          style={{ width: '50px', height: '50px' }}\n                        >\n                          {chat.role === 'vendor' ? 'ğŸª' : \n                           chat.role === 'shopkeeper' ? 'ğŸ›’' : 'ğŸ§'}\n                        </div>\n                        {chat.online && (\n                          <div \n                            className=\"position-absolute bg-success rounded-circle\"\n                            style={{ \n                              width: '12px', \n                              height: '12px', \n                              bottom: '2px', \n                              right: '2px',\n                              border: '2px solid white'\n                            }}\n                          />\n                        )}\n                      </div>\n                      <div className=\"flex-grow-1\">\n                        <div className=\"d-flex justify-content-between align-items-center\">\n                          <strong>{chat.name}</strong>\n                          <small className=\"text-muted\">{chat.time}</small>\n                        </div>\n                        <div className=\"d-flex justify-content-between align-items-center\">\n                          <small className=\"text-muted\">{chat.lastMessage}</small>\n                          {chat.unread > 0 && (\n                            <Badge bg=\"danger\" pill>{chat.unread}</Badge>\n                          )}\n                        </div>\n                      </div>\n                    </ListGroup.Item>\n                  ))}\n                </ListGroup>\n              </Card.Body>\n            </Card>\n          </Col>\n          \n          {/* Chat Window */}\n          <Col md={8} className=\"ps-2\">\n            <Card className=\"h-100 shadow-sm\">\n              {activeChat ? (\n                <>\n                  <Card.Header className=\"bg-primary text-white\">\n                    <div className=\"d-flex align-items-center justify-content-between\">\n                      <div className=\"d-flex align-items-center\">\n                        <div className=\"me-3\">\n                          <div \n                            className=\"rounded-circle bg-white text-primary d-flex align-items-center justify-content-center\"\n                            style={{ width: '40px', height: '40px' }}\n                          >\n                            {activeChat.role === 'vendor' ? 'ğŸª' : \n                             activeChat.role === 'shopkeeper' ? 'ğŸ›’' : 'ğŸ§'}\n                          </div>\n                        </div>\n                        <div>\n                          <h6 className=\"mb-0\">{activeChat.name}</h6>\n                          <small>\n                            {activeChat.online ? 'ğŸŸ¢ Online' : 'âš« Offline'} â€¢ \n                            ğŸ”’ End-to-end encrypted\n                          </small>\n                        </div>\n                      </div>\n                      <div>\n                        <Button variant=\"outline-light\" size=\"sm\" className=\"me-2\">\n                          ğŸ“\n                        </Button>\n                        <Button variant=\"outline-light\" size=\"sm\">\n                          ğŸ“¹\n                        </Button>\n                      </div>\n                    </div>\n                  </Card.Header>\n                  \n                  <Card.Body \n                    className=\"d-flex flex-column\"\n                    style={{ \n                      height: '400px',\n                      backgroundColor: '#e5ddd5',\n                      backgroundImage: 'linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%)',\n                      backgroundSize: '20px 20px'\n                    }}\n                  >\n                    <div className=\"flex-grow-1 overflow-auto mb-3\">\n                      {messages.map(msg => (\n                        <div \n                          key={msg.id} \n                          className={`d-flex mb-3 ${msg.sender === 'me' ? 'justify-content-end' : 'justify-content-start'}`}\n                        >\n                          <div \n                            className={`p-3 rounded-3 shadow-sm ${\n                              msg.sender === 'me' \n                                ? 'bg-success text-white' \n                                : 'bg-white'\n                            }`}\n                            style={{ maxWidth: '70%' }}\n                          >\n                            <div>{msg.content}</div>\n                            <div className={`d-flex justify-content-between align-items-center mt-1`}>\n                              <small className={msg.sender === 'me' ? 'text-light' : 'text-muted'}>\n                                {msg.time}\n                              </small>\n                              {msg.sender === 'me' && (\n                                <small className=\"text-light\">âœ“âœ“</small>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                      \n                      {isTyping && (\n                        <div className=\"d-flex justify-content-start mb-3\">\n                          <div className=\"bg-white p-3 rounded-3 shadow-sm\">\n                            <div className=\"typing-indicator\">\n                              <span></span>\n                              <span></span>\n                              <span></span>\n                            </div>\n                            <small className=\"text-muted\">Typing...</small>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                    \n                    {/* Quick Replies */}\n                    <div className=\"mb-3\">\n                      <div className=\"d-flex gap-2 flex-wrap\">\n                        {quickReplies.map((reply, index) => (\n                          <Button \n                            key={index}\n                            variant=\"outline-primary\" \n                            size=\"sm\"\n                            onClick={() => sendQuickReply(reply)}\n                          >\n                            {reply}\n                          </Button>\n                        ))}\n                      </div>\n                    </div>\n                    \n                    {/* Message Input */}\n                    <Form onSubmit={(e) => { e.preventDefault(); sendMessage(); }}>\n                      <InputGroup>\n                        <Button variant=\"outline-secondary\">\n                          ğŸ“\n                        </Button>\n                        <Form.Control\n                          type=\"text\"\n                          placeholder=\"Type a message...\"\n                          value={message}\n                          onChange={(e) => setMessage(e.target.value)}\n                        />\n                        <Button variant=\"outline-secondary\">\n                          ğŸ˜Š\n                        </Button>\n                        <Button variant=\"success\" type=\"submit\">\n                          ğŸ“¤\n                        </Button>\n                      </InputGroup>\n                    </Form>\n                  </Card.Body>\n                </>\n              ) : (\n                <Card.Body className=\"d-flex align-items-center justify-content-center\">\n                  <div className=\"text-center\">\n                    <div style={{ fontSize: '4rem' }}>ğŸ’¬</div>\n                    <h5 className=\"text-muted mt-3\">Select a chat to start messaging</h5>\n                    <p>Choose from your existing conversations or start a new one</p>\n                  </div>\n                </Card.Body>\n              )}\n            </Card>\n          </Col>\n        </Row>\n      </Container>\n      \n      <style>\n        {`\n          .typing-indicator {\n            display: flex;\n            align-items: center;\n            gap: 3px;\n            margin-bottom: 5px;\n          }\n          .typing-indicator span {\n            height: 8px;\n            width: 8px;\n            background-color: #999;\n            border-radius: 50%;\n            animation: typing 1.4s infinite ease-in-out;\n          }\n          .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }\n          .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }\n          @keyframes typing {\n            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }\n            40% { transform: scale(1); opacity: 1; }\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n\nexport default Chat;