import React, { useState } from 'react';\nimport { Container, Row, Col, Card, Button, Table, Badge, InputGroup, Form } from 'react-bootstrap';\nimport { useAuth } from '../../context/AuthContext';\nimport { toast } from 'react-toastify';\n\nconst Cart = () => {\n  const { cart, removeFromCart, updateCartQuantity, user } = useAuth();\n  const [couponCode, setCouponCode] = useState('');\n  const [discount, setDiscount] = useState(0);\n\n  const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);\n  const tax = Math.floor(subtotal * 0.18);\n  const total = subtotal + tax - discount;\n\n  const applyCoupon = () => {\n    const validCoupons = {\n      'SAVE10': 0.1,\n      'BULK20': 0.2,\n      'FIRST5': 0.05\n    };\n    \n    if (validCoupons[couponCode]) {\n      const discountAmount = Math.floor(subtotal * validCoupons[couponCode]);\n      setDiscount(discountAmount);\n      toast.success(`üéâ Coupon applied! You saved ‚Çπ${discountAmount}`);\n    } else {\n      toast.error('‚ùå Invalid coupon code');\n    }\n  };\n\n  const sendQuotation = () => {\n    if (cart.length === 0) {\n      toast.error('‚ùå Cart is empty!');\n      return;\n    }\n    \n    toast.success('üìã Quotation sent to vendors!');\n    // Navigate to chat or quotation page\n  };\n\n  const saveForLater = (item) => {\n    removeFromCart(item.cartId);\n    toast.info('üíæ Item saved for later');\n  };\n\n  return (\n    <div style={{ minHeight: '100vh', backgroundColor: '#f8f9fa' }}>\n      <Container fluid className=\"py-4\">\n        <Row>\n          <Col lg={8}>\n            <Card className=\"shadow-sm\">\n              <Card.Header className=\"bg-primary text-white\">\n                <h4 className=\"mb-0\">üõí Shopping Cart ({cart.length} items)</h4>\n              </Card.Header>\n              <Card.Body>\n                {cart.length === 0 ? (\n                  <div className=\"text-center py-5\">\n                    <div style={{ fontSize: '4rem' }}>üõí</div>\n                    <h5 className=\"text-muted mt-3\">Your cart is empty</h5>\n                    <p>Browse our categories to add products</p>\n                    <Button variant=\"primary\" href=\"/\">\n                      üõçÔ∏è Start Shopping\n                    </Button>\n                  </div>\n                ) : (\n                  <>\n                    <div className=\"table-responsive\">\n                      <Table hover className=\"align-middle\">\n                        <thead className=\"table-light\">\n                          <tr>\n                            <th>Product</th>\n                            <th>Quantity</th>\n                            <th>Price</th>\n                            <th>Total</th>\n                            <th>Actions</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {cart.map(item => (\n                            <tr key={item.cartId}>\n                              <td>\n                                <div className=\"d-flex align-items-center\">\n                                  <div className=\"me-3\" style={{ fontSize: '2rem' }}>\n                                    {item.name.includes('iPhone') ? 'üì±' :\n                                     item.name.includes('MacBook') ? 'üíª' : 'üì¶'}\n                                  </div>\n                                  <div>\n                                    <strong>{item.name}</strong>\n                                    <br />\n                                    <small className=\"text-muted\">{item.description}</small>\n                                    <br />\n                                    <Badge bg=\"info\">üè™ {item.vendor}</Badge>\n                                  </div>\n                                </div>\n                              </td>\n                              <td>\n                                <InputGroup size=\"sm\" style={{ width: '120px' }}>\n                                  <Button \n                                    variant=\"outline-secondary\" \n                                    onClick={() => updateCartQuantity(item.cartId, Math.max(1, item.quantity - 1))}\n                                  >\n                                    -\n                                  </Button>\n                                  <Form.Control \n                                    type=\"number\" \n                                    value={item.quantity} \n                                    min=\"1\"\n                                    className=\"text-center\"\n                                    onChange={(e) => updateCartQuantity(item.cartId, parseInt(e.target.value) || 1)}\n                                  />\n                                  <Button \n                                    variant=\"outline-secondary\" \n                                    onClick={() => updateCartQuantity(item.cartId, item.quantity + 1)}\n                                  >\n                                    +\n                                  </Button>\n                                </InputGroup>\n                              </td>\n                              <td className=\"text-success fw-bold\">\n                                ‚Çπ{item.price.toLocaleString()}\n                              </td>\n                              <td className=\"text-success fw-bold\">\n                                ‚Çπ{(item.price * item.quantity).toLocaleString()}\n                              </td>\n                              <td>\n                                <div className=\"d-flex gap-1\">\n                                  <Button \n                                    variant=\"outline-warning\" \n                                    size=\"sm\"\n                                    onClick={() => saveForLater(item)}\n                                    title=\"Save for later\"\n                                  >\n                                    üíæ\n                                  </Button>\n                                  <Button \n                                    variant=\"outline-danger\" \n                                    size=\"sm\"\n                                    onClick={() => {\n                                      removeFromCart(item.cartId);\n                                      toast.info(`${item.name} removed from cart`);\n                                    }}\n                                    title=\"Remove item\"\n                                  >\n                                    üóëÔ∏è\n                                  </Button>\n                                </div>\n                              </td>\n                            </tr>\n                          ))}\n                        </tbody>\n                      </Table>\n                    </div>\n                    \n                    {/* Coupon Section */}\n                    <div className=\"border-top pt-3 mb-3\">\n                      <Row>\n                        <Col md={6}>\n                          <h6>üé´ Have a coupon code?</h6>\n                          <InputGroup>\n                            <Form.Control\n                              type=\"text\"\n                              placeholder=\"Enter coupon code\"\n                              value={couponCode}\n                              onChange={(e) => setCouponCode(e.target.value.toUpperCase())}\n                            />\n                            <Button variant=\"outline-primary\" onClick={applyCoupon}>\n                              Apply\n                            </Button>\n                          </InputGroup>\n                          <small className=\"text-muted\">\n                            Try: SAVE10, BULK20, FIRST5\n                          </small>\n                        </Col>\n                      </Row>\n                    </div>\n                    \n                    <div className=\"border-top pt-3\">\n                      <Row className=\"align-items-center\">\n                        <Col md={6}>\n                          <h4 className=\"text-success mb-0\">\n                            üí∞ Total: ‚Çπ{total.toLocaleString()}\n                          </h4>\n                          {discount > 0 && (\n                            <small className=\"text-success\">\n                              üéâ You saved ‚Çπ{discount.toLocaleString()}\n                            </small>\n                          )}\n                        </Col>\n                        <Col md={6} className=\"text-end\">\n                          <Button \n                            variant=\"warning\" \n                            className=\"me-2\"\n                            onClick={sendQuotation}\n                          >\n                            üìã Request Quotation\n                          </Button>\n                          <Button \n                            variant=\"success\" \n                            onClick={() => toast.info('üöß Checkout coming soon!')}\n                          >\n                            üí≥ Proceed to Checkout\n                          </Button>\n                        </Col>\n                      </Row>\n                    </div>\n                  </>\n                )}\n              </Card.Body>\n            </Card>\n          </Col>\n          \n          <Col lg={4}>\n            <Card className=\"shadow-sm mb-4\">\n              <Card.Header className=\"bg-info text-white\">\n                <h6 className=\"mb-0\">üìä Order Summary</h6>\n              </Card.Header>\n              <Card.Body>\n                <div className=\"d-flex justify-content-between mb-2\">\n                  <span>Subtotal ({cart.reduce((sum, item) => sum + item.quantity, 0)} items)</span>\n                  <span>‚Çπ{subtotal.toLocaleString()}</span>\n                </div>\n                <div className=\"d-flex justify-content-between mb-2\">\n                  <span>Shipping</span>\n                  <span className=\"text-success\">Free</span>\n                </div>\n                <div className=\"d-flex justify-content-between mb-2\">\n                  <span>Tax (GST 18%)</span>\n                  <span>‚Çπ{tax.toLocaleString()}</span>\n                </div>\n                {discount > 0 && (\n                  <div className=\"d-flex justify-content-between mb-2 text-success\">\n                    <span>Discount</span>\n                    <span>-‚Çπ{discount.toLocaleString()}</span>\n                  </div>\n                )}\n                <hr />\n                <div className=\"d-flex justify-content-between fw-bold\">\n                  <span>Total</span>\n                  <span className=\"text-success\">‚Çπ{total.toLocaleString()}</span>\n                </div>\n              </Card.Body>\n            </Card>\n            \n            <Card className=\"shadow-sm\">\n              <Card.Header className=\"bg-secondary text-white\">\n                <h6 className=\"mb-0\">üí° Quick Actions</h6>\n              </Card.Header>\n              <Card.Body>\n                <div className=\"d-grid gap-2\">\n                  <Button variant=\"outline-primary\" size=\"sm\">\n                    üíæ Save Cart\n                  </Button>\n                  <Button variant=\"outline-info\" size=\"sm\">\n                    üì§ Share Cart\n                  </Button>\n                  <Button variant=\"outline-warning\" size=\"sm\">\n                    üìã Compare Products\n                  </Button>\n                  <Button variant=\"outline-success\" size=\"sm\">\n                    üí¨ Chat with Vendor\n                  </Button>\n                </div>\n              </Card.Body>\n            </Card>\n          </Col>\n        </Row>\n      </Container>\n    </div>\n  );\n};\n\nexport default Cart;